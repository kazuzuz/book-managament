{% extends 'base.html' %}
{% load static %}

{% block title%}
{{book.title}}
{%endblock%}

{% block css %}
<link rel="stylesheet" href="{% static 'css/pages/detail.css' %}">
{% endblock%}

{%block js%}
<script src="{% static 'js/pages/book/detail.js'%}"></script>
{% endblock%}


{% block content%}
        <div class="main">
            <div class="main_item">
                <div class="imgframe"></div>
            </div>

            <div class="main_item">
                <br>
                <h1>{{book.title}}</h1>
                <br>
                <h3>{{book.author}}</h3>
                <br>
                {% if user.is_authenticated %}
                    {% if book in favorite_book_list %}
                        <form action="{% url 'book:delete_favorite' book.id %}" mathod="post">
                            {% csrf_token %}
                            <input type="submit", class="btn2" value="お気に入り解除">
                        </form>
                    {% else %}
                        <form action="{% url 'book:add_favorite' book.id %}" mathod="post">
                            {% csrf_token %}
                            
                            <input type="submit", class="btn2", value="お気に入りに追加">
                        </form>
                    {% endif %}
                {% endif%}
            </div>
        </div>
        <div class="yokonarabe">
            <h2>{{book.title}}のレビュー</h2>      
            <button type="button" class="btn3" id="showModalBtn">レビューを書く</button>

        </div>
        {% for review in book.review_set.all %}
        <div class ="flexbox">

            <div class ="dotted-border">
                <div class ="flex_item">
                    <li>投稿者 : {{review.reviewer.username}}</li>
                    <br>
                    <li>投稿日 : {{review.created_at}}</li>
                    <br>
                    <li>評価 : {{review.score}}</li>
                    <br>
                    <li>レビュー : {{review.review_text}}</li>
                </div>
            </div>
        </div>
        {%endfor%}
        {% if not book.review_set.all %}
            <h3>レビューはまだ投稿されていません。</h3>
        {% endif %}
        

    <p>
        {% if error_message %}<p><strong>{{ error_message }}</strong></p>{% endif %}

    {% for key, errors in form.errors.items %}
        {% for error in errors %}
            <p><strong>{{ error }}</strong></p>
        {% endfor %}
    {% endfor %} 

        
    <div class="modal-background" id="modal" style="display: none;">
        <div class="modal-content">
            <h1>{{book.title}}<h1>
                <h3>レビューの内容を入力してください。</h3>
                <form action="{% url 'book:review' book.id %}" method="post">
                    {% csrf_token %}
                <div class="center-table">
                    <table border="1" class="table">
                        <tr>
                        <td class="table_item">作品の評価</td><td><input type="number" name="score" min="0" max="5" placeholder="点数"></td>
                        </tr>
                        <tr>
                        <td class="table_item">レビューのタイトル</td><td></td>
                        </tr>
                        <tr>
                            <td class="table_item">レビューの内容</td><td class="table_item2"><textarea name="review_text" id="review_text" rows="10" cols="50" placeholder="ここにレビュー内容を入力してください" class="custom-textarea"></textarea>
                            </td>
                        </tr>
                    </table>
                </div>
                
                    <input type="submit" value="投稿" class="btn3" id="closeModalBtn">
                </form>
        </div>
    </div>

{% endblock %}
